<ng-container
    [ngTemplateOutlet]="recipesList",
    [ngTemplateOutletContext]="{ $implicit: localState$ | async }"
></ng-container>

<ng-template #recipesList let-localState>

    <section>

        <br>Page: <span>{{localState.pageOptions.pageIndex}}</span>
        <br>Entries per page: {{localState.pageOptions.pageEntriesLimit}}
        <br>Total results: {{localState.recipesCount}}
        <br>Total pages: {{getTotalPagesCount(localState.pageOptions.pageEntriesLimit, localState.recipesCount)}}

    </section>

    <ng-container *ngIf="localState.loading">
        Loading, please wait...
    </ng-container>

    <ng-container *ngIf="!localState.loading">

        <form 
            #filterResultsForm="ngForm" 
            class="filter-form form" 
            ngForm
        >

            <ngx-paginator
                [current]="localState.pageOptions.pageIndex" 
                [total]="getTotalPagesCount(localState.pageOptions.pageEntriesLimit, localState.recipesCount)" 
                (previous)="togglePreviousPage($event)" 
                (goTo)="toggleClickedPage($event)"
                (next)="toggleNextPage($event, getTotalPagesCount(localState.pageOptions.pageEntriesLimit, localState.recipesCount))"
            ></ngx-paginator>

            <section class="select-row form-row">

                <select 
                    [ngModel]="localState.pageOptions.pageEntriesLimit"
                    class="filter-form-limit-select form-input" 
                    id="limit" 
                    name="limit"
                >
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                </select>

            </section>

            <section class="form-row">

                <input 
                    class="filter-form-title-input form-input" 
                    #filterByTitleInput="ngModel" 
                    [ngModel]="localState.pageOptions.pageQueryFilter?.title ?? ''" 
                    type="text" 
                    name="title" 
                    placeholder="Filter results by title..." 
                />

            </section>

        </form>

        <section class="recipes-list" *ngIf="localState.recipes && localState.recipes?.length">

            <article class="recipe-thumb" *ngFor="let recipe of localState.recipes">
                <p>Title: {{recipe.title | uppercase}}</p>
                <p>Author: {{recipe.authorId?.username}}</p>
                <p>Created: {{recipe.createdAt | date}}</p>
            </article>

        </section>
    
        <ng-container *ngIf="!localState.recipes || !localState.recipes?.length">
            No recipes to display.
        </ng-container>

    </ng-container>

</ng-template>
