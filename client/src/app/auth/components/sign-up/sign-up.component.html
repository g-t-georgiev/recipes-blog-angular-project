<section class="form-container">

    <header class="form-container-header">
        <h2>Create an account</h2>
    </header>

    <section 
        *ngIf="registerForm.form.invalid"
        class="form-error"
    >
        Please fill in all the fields correctly!
    </section>

    <form 
        #registerForm="ngForm" 
        (ngSubmit)="submitHandler(registerForm)"
        class="form"
    >

        <section class="form-row">

            <label 
                class="form-input-label" 
                for="email"
            >
                Email
            </label>

            <input 
                ngModel 
                required 
                email 
                #emailControl="ngModel" 
                class="form-input"
                type="email" 
                name="email" 
                id="email" 
                placeholder="Email" 
                aria-required="true"
            />

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg"
                [ngTemplateOutletContext]="{ $implicit: 'Email is required' }"
                *ngIf="emailControl.touched && emailControl.errors?.['required']"
            ></ng-container>

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg"
                [ngTemplateOutletContext]="{ $implicit: 'Invalid email' }"
                *ngIf="emailControl.touched && emailControl.errors?.['email']"
            ></ng-container>

        </section>
    
        <section class="form-row">

            <label 
                class="form-input-label" 
                for="username"
            >
                Username
            </label>

            <input 
                ngModel 
                required 
                minlength="4" 
                customMaxlength="30" 
                pattern="(?=[A-Za-z]+)^[A-Za-z0-9]+$" 
                #usernameControl="ngModel" 
                class="form-input" 
                type="text" 
                name="username" 
                id="username" 
                placeholder="Username" 
                aria-required="true" 
            />

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Username is required' }"
                *ngIf="usernameControl.touched && usernameControl.errors?.['required']"
            ></ng-container>

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Username should be at least 4 characters long' }"
                *ngIf="usernameControl.touched && usernameControl.errors?.['minlength']"
            ></ng-container>

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Username should be no more than 30 characters long' }"
                *ngIf="usernameControl.touched && usernameControl.errors?.['maxlength']"
            ></ng-container>

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Username should start with a letter and contain letters and digits only' }"
                *ngIf="usernameControl.touched && usernameControl.errors?.['pattern']"
            ></ng-container>

        </section>

        <app-file-upload 
            [ngModel]="null"
            name="profilePicture"
            label="Choose profile picture" 
            accept=".jpeg, .jpg, .png, .svg"
        ></app-file-upload>
    
        <section class="form-row">

            <label 
                class="form-input-label" 
                for="password"
            >
                Password
            </label>

            <input 
                ngModel 
                required 
                minlength="6" 
                pattern="[a-zA-Z0-9]+"
                #passwordControl="ngModel" 
                class="form-input" 
                type="password" 
                name="password" 
                id="password" 
                placeholder="Password" 
                aria-required="true" 
            />

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Password is required' }"
                *ngIf="passwordControl.touched && passwordControl.errors?.['required']"
            ></ng-container>

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Password should be at least 6 characters long' }"
                *ngIf="passwordControl.touched && passwordControl.errors?.['minlength']"
            ></ng-container>

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Password should contain latin letters and digits only' }"
                *ngIf="passwordControl.touched && passwordControl.errors?.['pattern']"
            ></ng-container>

        </section>

        <section class="form-row">

            <label 
                class="form-input-label" 
                for="confirm-password"
            >
                Confirm password
            </label>

            <input 
                ngModel 
                required 
                [passwordsMatch]="passwordControl.control"
                #confirmPasswordControl="ngModel" 
                class="form-input" 
                type="password" 
                name="repeatPassword" 
                id="confirm-password" 
                placeholder="Confirm password" 
                aria-required="true" 
            />

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Confirm password is required' }"
                *ngIf="confirmPasswordControl.touched && confirmPasswordControl.errors?.['required']"
            ></ng-container>

            <ng-container 
                [ngTemplateOutlet]="formInputErrorMsg" 
                [ngTemplateOutletContext]="{ $implicit: 'Passwords do not match' }"
                *ngIf="confirmPasswordControl.touched && confirmPasswordControl.errors?.['mismatch']"
            ></ng-container>

        </section>
    
        <button 
            [disabled]="registerForm.invalid"
            class="form-submit-btn" 
            type="submit"
        >
            Login
        </button>

    </form>

    <footer class="form-container-footer">
        <p class="form-container-footer-content">
            Already have an account? <a [routerLink]="[ '/users', 'login' ]">Sign in.</a>
        </p>
    </footer>

</section>

<ng-template #formInputErrorMsg let-errorTxt>
    <section class="form-input-error">
        {{errorTxt}}
    </section>
</ng-template>